import React, { useState, useEffect } from \'react\';\nimport { View, Text, TextInput, Button, FlatList, StyleSheet, Alert, ActivityIndicator } from \'react-native\';\nimport { youtubeDownloaderService } from \'@/services/youtubeDownloader\';\nimport { Song } from \'@/types/storage\';\nimport { storageService } from \'@/services/storageService\';\nimport { theme } from \'@/constants/theme\'; // Import theme\n\nconst DownloadScreen = () => {\n  const [youtubeUrl, setYoutubeUrl] = useState(\'\');\n  const [downloadProgress, setDownloadProgress] = useState(0);\n  const [downloadedSongs, setDownloadedSongs] = useState<Song[]>([]);\n  const [quality, setQuality] = useState<\'low\' | \'medium\' | \'high\'>(\'medium\');\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  useEffect(() => {\n    loadDownloadedSongs();\n  }, []);\n\n  const loadDownloadedSongs = async () => {\n    const songs = await storageService.getDownloadedSongs();\n    setDownloadedSongs(songs);\n  };\n\n  const handleDownload = async () => {\n    if (!youtubeDownloaderService.validateYouTubeUrl(youtubeUrl)) {\n      Alert.alert(\'Invalid URL\', \'Please enter a valid YouTube URL.\');\n      return;\n    }\n\n    setIsDownloading(true);\n    setDownloadProgress(0);\n\n    try {\n      const newSong = await youtubeDownloaderService.downloadAudio(\n        youtubeUrl,\n        quality,\n        (progress) => {\n          setDownloadProgress(progress);\n        }\n      );\n      if (newSong) {\n        Alert.alert(\'Success\', `Downloaded: ${newSong.title}`);\n        setDownloadedSongs((prevSongs) => [...prevSongs, newSong]);\n        setYoutubeUrl(\'\');\n      }\n    } catch (error: any) {\n      Alert.alert(\'Download Failed\', error.message || \'An unknown error occurred during download.\');\n    } finally {\n      setIsDownloading(false);\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <Text style={styles.title}>Download from YouTube</Text>\n      \n      <TextInput\n        style={styles.input}\n        placeholder=\"Paste YouTube URL here\"\n        value={youtubeUrl}\n        onChangeText={setYoutubeUrl}\n        editable={!isDownloading}\n        placeholderTextColor={theme.Components.Input.placeholder}\n      />\n\n      <View style={styles.qualitySelector}>\n        <Button title=\"Low\" onPress={() => setQuality(\'low\')} color={quality === \'low\' ? theme.Colors.primary : theme.Colors.textMuted} disabled={isDownloading} />\n        <Button title=\"Medium\" onPress={() => setQuality(\'medium\')} color={quality === \'medium\' ? theme.Colors.primary : theme.Colors.textMuted} disabled={isDownloading} />\n        <Button title=\"High\" onPress={() => setQuality(\'high\')} color={quality === \'high\' ? theme.Colors.primary : theme.Colors.textMuted} disabled={isDownloading} />\n      </View>\n\n      <Button title={isDownloading ? \"Downloading...\" : \"Download\"} onPress={handleDownload} disabled={isDownloading} />\n\n      {isDownloading && downloadProgress > 0 && (\n        <View style={styles.progressContainer}>\n          <Text style={styles.progressText}>Downloading: {Math.round(downloadProgress * 100)}%</Text>\n          <View style={styles.progressBar}>\n            <View style={{...styles.progress, width: `${downloadProgress * 100}%`}} />\n          </View>\n          <ActivityIndicator size=\"small\" color={theme.Colors.primary} />\n        </View>\n      )}\n\n      <Text style={styles.listHeader}>Downloaded Videos</Text>\n      <FlatList\n        data={downloadedSongs}\n        keyExtractor={(item) => item.id}\n        renderItem={({ item }) => (\n          <View style={styles.videoItem}>\n            <Text style={styles.videoItemTitle}>{item.title}</Text>\n            <Text style={styles.videoItemSubtitle}>Artist: {item.artist} | Quality: {item.source} | Size: N/A</Text> \n          </View>\n        )}\n      />\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    padding: theme.Spacing.medium,\n    backgroundColor: theme.Colors.background,\n  },\n  title: {\n    fontSize: theme.Typography.size.h2,\n    fontWeight: theme.Typography.weight.bold,\n    marginBottom: theme.Spacing.large,\n    textAlign: \'center\',\n    color: theme.Colors.textPrimary,\n  },\n  input: {\n    ...theme.Components.Input.default,\n    height: 50,\n    marginBottom: theme.Spacing.medium,\n    fontSize: theme.Typography.size.medium,\n  },\n  qualitySelector: {\n    flexDirection: \'row\',\n    justifyContent: \'space-around\',\n    marginBottom: theme.Spacing.medium,\n  },\n  progressContainer: {\n    marginVertical: theme.Spacing.medium,\n    alignItems: \'center\',\n  },\n  progressText: {\n    color: theme.Colors.textPrimary,\n    marginBottom: theme.Spacing.small,\n  },\n  progressBar: {\n    height: 10,\n    width: \'100%\',\n    backgroundColor: theme.Colors.divider,\n    borderRadius: 5,\n    marginTop: theme.Spacing.small,\n    overflow: \'hidden\',\n  },\n  progress: {\n    height: \'100%\',\n    backgroundColor: theme.Colors.success,\n    borderRadius: 5,\n  },\n  listHeader: {\n    fontSize: theme.Typography.size.h3,\n    fontWeight: theme.Typography.weight.bold,\n    marginTop: theme.Spacing.xLarge,\n    marginBottom: theme.Spacing.medium,\n    color: theme.Colors.textPrimary,\n  },\n  videoItem: {\n    backgroundColor: theme.Colors.card,\n    padding: theme.Spacing.medium,\n    borderRadius: theme.Spacing.small,\n    marginBottom: theme.Spacing.small,\n    shadowColor: theme.Colors.background,\n    shadowOffset: { width: 0, height: 1 },\n    shadowOpacity: 0.2,\n    shadowRadius: 1.41,\n    elevation: 2,\n  },\n  videoItemTitle: {\n    fontSize: theme.Typography.size.medium,\.fontWeight: theme.Typography.weight.semibold,\n    color: theme.Colors.textPrimary,\n  },\n  videoItemSubtitle: {\n    fontSize: theme.Typography.size.small,\n    color: theme.Colors.textSecondary,\n    marginTop: theme.Spacing.xSmall,\n  },\n});\n\nexport default DownloadScreen;\n